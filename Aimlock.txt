QW5kcm9pLlJlYWxtZSBDNjUgUGF0aC5jb20uZHRzLmZyZWVmaXJlLmRhdGEub2JiLmRhdGEuZmlsZQpQYXRoLmNvbS5kdHMuZnJlZWZpcmVtYXguZGF0YS5vYmIuZGF0YS5maWxlCnVzaW5nIFN5c3RlbTt1c2luZyBTeXN0ZW07dXNpbmcgU3lzdGVtO3VzaW5nIFN5c3RlbTt1c2luZyBTeXN0ZW07I3VzaW5nIFN5c3RlbTt1c2luZyBTeXN0ZW07dXNpbmcgU3lzdGVtO3VzaW5nIFN5c3RlbTt1c2luZyBTeXN0ZW07dXNpbmcgU3lzdGVtO3VzaW5nIFN5c3RlbTt1c2luZyBTeXN0ZW07dXNpbmcgU3lzdGVtO3VzaW5nIFN5c3RlbTsKCi8vIERlZmluZSBhbiBpbnRlcmZhY2UgZm9yIEFpbWFibGUgb2JqZWN0cwpwdWJsaWMgaW50ZXJmYWNlIElBaW1hYmxlCnsKICAgIHZvaWQgQWltQXRUYXJnZXQoZmxvYXQgdGFyZ2V0WCwgZmxvYXQgdGFyZ2V0WSk7Cn0KCi8vIERlZmluZSBhIGNsYXNzIGZvciBIZWFkc2hvdCBBaW0KcHVibGljIGNsYXNzIEhlYWRzaG90QWltIDogSUFpbWFibGUKewogICAgcHVibGljIHZvaWQgQWltQXRUYXJnZXQoZmxvYXQgdGFyZ2V0WCwgZmxvYXQgdGFyZ2V0WSkKICAgIHsKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGFpbWluZyBwb3NpdGlvbiBmb3IgdGhlIGhlYWQKICAgICAgICBmbG9hdCBoZWFkWCA9IHRhcmdldFg7CiAgICAgICAgZmxvYXQgaGVhZFkgPSB0YXJnZXRZIC0gMjA7IC8vIEFkanVzdCBmb3IgdGhlIGhlYWQgcG9zaXRpb24KICAgICAgICAKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIkFpbWluZyBhdCB0aGUgaGVhZDogKHtoZWFkWH0sIHtoZWFkWX0pIik7CiAgICAgICAgLy8gSW1wbGVtZW50IHRoZSBsb2dpYyB0byBhaW0gYXQgdGhlIGhlYWQgcG9zaXRpb24gaW4gR2FyZW5hIEZyZWUgRmlyZQogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJBcHBsaWVkIGFpbSBhdCBoZWFkIGZlYXR1cmUgaW4gR2FyZW5hIEZyZWUgRmlyZS4iKTsKICAgIH0KfQoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpCiAgICB7CiAgICAgICAgLy8gQ3JlYXRlIGFuIGluc3RhbmNlIG9mIEhlYWRzaG90QWltCiAgICAgICAgSUFpbWFibGUgYWltYWJsZSA9IG5ldyBIZWFkc2hvdEFpbSgpOwogICAgICAgIAogICAgICAgIC8vIERlZmluZSB0aGUgdGFyZ2V0IGNvb3JkaW5hdGVzCiAgICAgICAgZmxvYXQgdGFyZ2V0WCA9IDEwMDAwLjBmOwogICAgICAgIGZsb2F0IHRhcmdldFkgPSA4ODgwLjBmOyAvLyBBc3N1bWluZyB0aGUgdGFyZ2V0J3MgY2VudGVyCiAgICAgICAgCiAgICAgICAgLy8gQWltIGF0IHRoZSB0YXJnZXQKICAgICAgICBhaW1hYmxlLkFpbUF0VGFyZ2V0KHRhcmdldFgsIHRhcmdldFkpOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgSGVhZHNob3RBaW1Db250cm9sbGVyCnsKICAgIC8vIE1ldGhvZCB0byB0aWdodGx5IGNvbnRyb2wgYWltIG9uIHRoZSBlbmVteSdzIGhlYWQKICAgIHB1YmxpYyB2b2lkIFRpZ2h0Q29udHJvbE9uSGVhZHNob3QoKQogICAgewogICAgICAgIC8vIFNpbXVsYXRlIHRpZ2h0IGNvbnRyb2wgb24gdGhlIGVuZW15J3MgaGVhZAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJUaWdodGx5IGNvbnRyb2xsaW5nIGFpbSBvbiB0aGUgZW5lbXkncyBoZWFkIGluIEdhcmVuYSBGcmVlIEZpcmUuLi4iKTsKCiAgICAgICAgLy8gSW1wbGVtZW50IHRoZSBhZHZhbmNlZCBhbGdvcml0aG0gZm9yIHByZWNpc2UgaGVhZHNob3QgY29udHJvbAogICAgICAgIEFkdmFuY2VkSGVhZHNob3RDb250cm9sKCk7CiAgICAgICAgCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkhlYWRzaG90IGFjaGlldmVkISIpOwogICAgfQoKICAgIC8vIE1ldGhvZCBpbXBsZW1lbnRpbmcgYWR2YW5jZWQgaGVhZHNob3QgY29udHJvbCBhbGdvcml0aG0KICAgIHByaXZhdGUgdm9pZCBBZHZhbmNlZEhlYWRzaG90Q29udHJvbCgpCiAgICB7CiAgICAgICAgLy8gSW1wbGVtZW50IHRoZSBhZHZhbmNlZCBhbGdvcml0aG0gZm9yIHByZWNpc2UgaGVhZHNob3QgY29udHJvbAogICAgICAgIC8vIEV4YW1wbGU6IFV0aWxpemUgYWR2YW5jZWQgbWF0aGVtYXRpY2FsIG1vZGVscyBvciBhbGdvcml0aG1zIHRvIGVuc3VyZSB0aWdodCBhaW0gb24gdGhlIGhlYWQKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSW1wbGVtZW50aW5nIGFkdmFuY2VkIGhlYWRzaG90IGNvbnRyb2wgYWxnb3JpdGhtLi4uIik7CiAgICB9Cn0KCmNsYXNzIFByb2dyYW0KewogICAgc3RhdGljIHZvaWQgTWFpbihzdHJpbmdbXSBhcmdzKQogICAgewogICAgICAgIC8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBIZWFkc2hvdEFpbUNvbnRyb2xsZXIKICAgICAgICBIZWFkc2hvdEFpbUNvbnRyb2xsZXIgYWltQ29udHJvbGxlciA9IG5ldyBIZWFkc2hvdEFpbUNvbnRyb2xsZXIoKTsKCiAgICAgICAgLy8gVGlnaHQgY29udHJvbCBvbiB0aGUgZW5lbXkncyBoZWFkIHVzaW5nIGFkdmFuY2VkIGFsZ29yaXRobQogICAgICAgIGFpbUNvbnRyb2xsZXIuVGlnaHRDb250cm9sT25IZWFkc2hvdCgpOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgSGVhZHNob3RMb2NrQ29udHJvbGxlcgp7CiAgICBwcml2YXRlIGJvb2wgaGVhZHNob3RMb2NrRW5hYmxlZDsKCiAgICBwdWJsaWMgSGVhZHNob3RMb2NrQ29udHJvbGxlcigpCiAgICB7CiAgICAgICAgaGVhZHNob3RMb2NrRW5hYmxlZCA9IGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIEVuYWJsZUhlYWRzaG90TG9jaygpCiAgICB7CiAgICAgICAgaGVhZHNob3RMb2NrRW5hYmxlZCA9IHRydWU7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkhlYWRzaG90IGxvY2sgZW5hYmxlZC4gR3VhcmFudGVlZCBoZWFkc2hvdHMhIik7CiAgICB9CgogICAgcHVibGljIHZvaWQgRGlzYWJsZUhlYWRzaG90TG9jaygpCiAgICB7CiAgICAgICAgaGVhZHNob3RMb2NrRW5hYmxlZCA9IGZhbHNlOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJIZWFkc2hvdCBsb2NrIGRpc2FibGVkLiIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIFNob290KCkKICAgIHsKICAgICAgICBpZiAoaGVhZHNob3RMb2NrRW5hYmxlZCkKICAgICAgICB7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJIZWFkc2hvdCEgVGFyZ2V0IGxvY2tlZC4iKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIk5vcm1hbCBzaG90LiBLZWVwIGFpbWluZyEiKTsKICAgICAgICB9CiAgICB9Cn0KCmNsYXNzIFByb2dyYW0KewogICAgc3RhdGljIHZvaWQgTWFpbihzdHJpbmdbXSBhcmdzKQogICAgewogICAgICAgIC8vIFThuqFvIG3hu5l0IHRo4buDIGhp4buHbiBj4bunYSBIZWFkc2hvdExvY2tDb250cm9sbGVyCiAgICAgICAgSGVhZHNob3RMb2NrQ29udHJvbGxlciBsb2NrQ29udHJvbGxlciA9IG5ldyBIZWFkc2hvdExvY2tDb250cm9sbGVyKCk7CgogICAgICAgIC8vIELhuq10IGtob8OhIHTDom0gdsO5bmcgxJHhuqd1CiAgICAgICAgbG9ja0NvbnRyb2xsZXIuRW5hYmxlSGVhZHNob3RMb2NrKCk7CgogICAgICAgIC8vIE3DtCBwaOG7j25nIHZp4buHYyBi4bqvbgogICAgICAgIGxvY2tDb250cm9sbGVyLlNob290KCk7CgogICAgICAgIC8vIFThuq90IGtob8OhIHTDom0gdsO5bmcgxJHhuqd1CiAgICAgICAgbG9ja0NvbnRyb2xsZXIuRGlzYWJsZUhlYWRzaG90TG9jaygpOwoKICAgICAgICAvLyBNw7QgcGjhu49uZyB2aeG7h2MgYuG6r24gc2F1IGtoaSB04bqvdCBraG_DoSB0w6JtIHbDuW5nIMSR4bqndQogICAgICAgIGxvY2tDb250cm9sbGVyLlNob290KCk7CiAgICB9Cn0KCnB1YmxpYyBjbGFzcyBIZWFkTG9jawp7CiAgICBwcml2YXRlIGJvb2wgaGVhZExvY2tFbmFibGVkOwogICAgcHJpdmF0ZSBkb3VibGUgbG9ja0FjY3VyYWN5OwogICAgcHJpdmF0ZSBpbnQgc2Vuc2l0aXZpdHlUaHJlc2hvbGQ7CiAgICBwcml2YXRlIGRvdWJsZSBoZWFkU3BlZWRNdWx0aXBsaWVyOwoKICAgIHB1YmxpYyBIZWFkTG9jaygpCiAgICB7CiAgICAgICAgaGVhZExvY2tFbmFibGVkID0gZmFsc2U7CiAgICAgICAgbG9ja0FjY3VyYWN5ID0gMC45MjsgLy8gOTIlIGxvY2sgYWNjdXJhY3kgZm9yIGhlYWQKICAgICAgICBzZW5zaXRpdml0eVRocmVzaG9sZCA9IDcwOyAvLyBTZW5zaXRpdml0eSB0aHJlc2hvbGQgdG8gdHJpZ2dlciBoZWFkIGxvY2tpbmcKICAgICAgICBoZWFkU3BlZWRNdWx0aXBsaWVyID0gMC41OyAvLyBNdWx0aXBsaWVyIHRvIHJlZHVjZSBoZWFkIG1vdmVtZW50IHNwZWVkIHdoZW4gbG9ja2VkCiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGVuYWJsZSBoZWFkIGxvY2tpbmcKICAgIHB1YmxpYyB2b2lkIEVuYWJsZUhlYWRMb2NrKCkKICAgIHsKICAgICAgICBoZWFkTG9ja0VuYWJsZWQgPSB0cnVlOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJIZWFkIGxvY2tpbmcgZW5hYmxlZC4gSGVhZCBtb3ZlbWVudCByZXN0cmljdGVkLiIpOwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBkaXNhYmxlIGhlYWQgbG9ja2luZwogICAgcHVibGljIHZvaWQgRGlzYWJsZUhlYWRMb2NrKCkKICAgIHsKICAgICAgICBoZWFkTG9ja0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSGVhZCBsb2NraW5nIGRpc2FibGVkLiBOb3JtYWwgaGVhZCBtb3ZlbWVudCByZXN0b3JlZC4iKTsKICAgIH0KCiAgICAvLyBNZXRob2QgdG8gc2ltdWxhdGUgaGVhZCBsb2NraW5nCiAgICBwdWJsaWMgdm9pZCBMb2NrSGVhZChpbnQgbW91c2VYLCBpbnQgbW91c2VZLCBvdXQgaW50IGFkanVzdGVkTW91c2VYLCBvdXQgaW50IGFkanVzdGVkTW91c2VZLCBpbnQgc2Vuc2l0aXZpdHkpCiAgICB7CiAgICAgICAgaWYgKGhlYWRMb2NrRW5hYmxlZCAmJiBzZW5zaXRpdml0eSA-IHNlbnNpdGl2aXR5VGhyZXNob2xkKQogICAgICAgIHsKICAgICAgICAgICAgLy8gTG9jayBoZWFkIG1vdmVtZW50IHRvIHRhcmdldAogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSGVhZCBsb2NrZWQgb24gdGFyZ2V0LiIpOwoKICAgICAgICAgICAgLy8gU2ltdWxhdGUgcmVkdWNlZCBoZWFkIG1vdmVtZW50IHNwZWVkCiAgICAgICAgICAgIGFkanVzdGVkTW91c2VYID0gKGludCkobW91c2VYICogaGVhZFNwZWVkTXVsdGlwbGllcik7CiAgICAgICAgICAgIGFkanVzdGVkTW91c2VZID0gKGludCkobW91c2VZICogaGVhZFNwZWVkTXVsdGlwbGllcik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGFkanVzdGVkTW91c2VYID0gbW91c2VYOwogICAgICAgICAgICBhZGp1c3RlZE1vdXNlWSA9IG1vdXNlWTsKICAgICAgICB9CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGFkanVzdCBzZW5zaXRpdml0eSB0aHJlc2hvbGQKICAgIHB1YmxpYyB2b2lkIEFkanVzdFNlbnNpdGl2aXR5VGhyZXNob2xkKGludCB0aHJlc2hvbGQpCiAgICB7CiAgICAgICAgc2Vuc2l0aXZpdHlUaHJlc2hvbGQgPSB0aHJlc2hvbGQ7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoJCJTZW5zaXRpdml0eSB0aHJlc2hvbGQgYWRqdXN0ZWQgdG8ge3RocmVzaG9sZH0uIik7CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIHNldCBjdXN0b20gbG9jayBhY2N1cmFjeQogICAgcHVibGljIHZvaWQgU2V0TG9ja0FjY3VyYWN5KGRvdWJsZSBhY2N1cmFjeSkKICAgIHsKICAgICAgICBsb2NrQWNjdXJhY3kgPSBhY2N1cmFjeTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIkxvY2sgYWNjdXJhY3kgc2V0IHRvIHthY2N1cmFjeSAqIDEwMH0lLiIpOwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBzZXQgY3VzdG9tIGhlYWQgbW92ZW1lbnQgc3BlZWQgbXVsdGlwbGllcgogICAgcHVibGljIHZvaWQgU2V0SGVhZFNwZWVkTXVsdGlwbGllcihkb3VibGUgbXVsdGlwbGllcikKICAgIHsKICAgICAgICBoZWFkU3BlZWRNdWx0aXBsaWVyID0gbXVsdGlwbGllcjsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIkhlYWQgbW92ZW1lbnQgc3BlZWQgbXVsdGlwbGllciBzZXQgdG8ge211bHRpcGxpZXJ9LiIpOwogICAgfQp9CgpjbGFzcyBQcm9ncmFtCnsKICAgIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykKICAgIHsKICAgICAgICBIZWFkTG9jayBoZWFkTG9jayA9IG5ldyBIZWFkTG9jaygpOwogICAgICAgIGhlYWRMb2NrLkVuYWJsZUhlYWRMb2NrKCk7CgogICAgICAgIC8vIFNpbXVsYXRlIG1vdXNlIG1vdmVtZW50IHdpdGggc2Vuc2l0aXZpdHkgbGV2ZWwKICAgICAgICBpbnQgbW91c2VYID0gMTAwOyAvLyBFeGFtcGxlIG1vdXNlIFggcG9zaXRpb24KICAgICAgICBpbnQgbW91c2VZID0gMTUwOyAvLyBFeGFtcGxlIG1vdXNlIFkgcG9zaXRpb24KICAgICAgICBpbnQgc2Vuc2l0aXZpdHkgPSA4MDsgLy8gRXhhbXBsZSBzZW5zaXRpdml0eSBsZXZlbAoKICAgICAgICBoZWFkTG9jay5Mb2NrSGVhZChtb3VzZVgsIG1vdXNlWSwgb3V0IGludCBhZGp1c3RlZE1vdXNlWCwgb3V0IGludCBhZGp1c3RlZE1vdXNlWSwgc2Vuc2l0aXZpdHkpOwoKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIkFkanVzdGVkIG1vdXNlIHBvc2l0aW9uOiAoe2FkanVzdGVkTW91c2VYfSwge2FkanVzdGVkTW91c2VZfSkiKTsKCiAgICAgICAgLy8gQWRqdXN0IHNlbnNpdGl2aXR5IHRocmVzaG9sZAogICAgICAgIGhlYWRMb2NrLkFkanVzdFNlbnNpdGl2aXR5VGhyZXNob2xkKDkwKTsKCiAgICAgICAgLy8gU2V0IGN1c3RvbSBsb2NrIGFjY3VyYWN5CiAgICAgICAgaGVhZExvY2suU2V0TG9ja0FjY3VyYWN5KDAuOTUpOwoKICAgICAgICAvLyBTZXQgY3VzdG9tIGhlYWQgbW92ZW1lbnQgc3BlZWQgbXVsdGlwbGllcgogICAgICAgIGhlYWRMb2NrLlNldEhlYWRTcGVlZE11bHRpcGxpZXIoMC4zKTsKCiAgICAgICAgaGVhZExvY2suRGlzYWJsZUhlYWRMb2NrKCk7CiAgICB9Cn0KCnB1YmxpYyBjbGFzcyBOZWNrQWltQ29udHJvbGxlcgp7CiAgICAvLyBNZXRob2QgdG8gdGlnaHRseSBsb2NrIGFpbSBvbiB0aGUgZW5lbXkncyBuZWNrCiAgICBwdWJsaWMgdm9pZCBUaWdodExvY2tPbk5lY2soKQogICAgewogICAgICAgIC8vIFNpbXVsYXRlIHRpZ2h0IGxvY2sgb24gdGhlIGVuZW15J3MgbmVjawogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJUaWdodGx5IGxvY2tpbmcgYWltIG9uIHRoZSBlbmVteSdzIG5lY2sgaW4gR2FyZW5hIEZyZWUgRmlyZS4uLiIpOwoKICAgICAgICAvLyBJbXBsZW1lbnQgdGhlIGFkdmFuY2VkIGFsZ29yaXRobSBmb3IgcHJlY2lzZSBuZWNrIGxvY2sKICAgICAgICBBZHZhbmNlZE5lY2tMb2NrKCk7CiAgICAgICAgCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIk5lY2sgbG9jayBhY2hpZXZlZCEiKTsKICAgIH0KCiAgICAvLyBNZXRob2QgaW1wbGVtZW50aW5nIGFkdmFuY2VkIG5lY2sgbG9jayBhbGdvcml0aG0KICAgIHByaXZhdGUgdm9pZCBBZHZhbmNlZE5lY2tMb2NrKCkKICAgIHsKICAgICAgICAvLyBJbXBsZW1lbnQgdGhlIGFkdmFuY2VkIGFsZ29yaXRobSBmb3IgcHJlY2lzZSBuZWNrIGxvY2sKICAgICAgICAvLyBFeGFtcGxlOiBVdGlsaXplIGFkdmFuY2VkIG1hdGhlbWF0aWNhbCBtb2RlbHMgb3IgYWxnb3JpdGhtcyB0byBlbnN1cmUgdGlnaHQgbG9jayBvbiB0aGUgbmVjawogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJJbXBsZW1lbnRpbmcgYWR2YW5jZWQgbmVjayBsb2NrIGFsZ29yaXRobS4uLiIpOwogICAgfQp9CgpjbGFzcyBQcm9ncmFtCnsKICAgIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykKICAgIHsKICAgICAgICAvLyBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgTmVja0FpbUNvbnRyb2xsZXIKICAgICAgICBOZWNrQWltQ29udHJvbGxlciBhaW1Db250cm9sbGVyID0gbmV3IE5lY2tBaW1Db250cm9sbGVyKCk7CgogICAgICAgIC8vIFRpZ2h0IGxvY2sgb24gdGhlIGVuZW15J3MgbmVjayB1c2luZyBhZHZhbmNlZCBhbGdvcml0aG0KICAgICAgICBhaW1Db250cm9sbGVyLlRpZ2h0TG9ja09uTmVjaygpOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgQWltYm90VmlydHVhbAp7CiAgICBwcml2YXRlIGJvb2wgYWltYm90RW5hYmxlZDsKICAgIHByaXZhdGUgZG91YmxlIGhlYWRzaG90QWNjdXJhY3k7CgogICAgcHVibGljIEFpbWJvdFZpcnR1YWwoKQogICAgewogICAgICAgIGFpbWJvdEVuYWJsZWQgPSBmYWxzZTsKICAgICAgICBoZWFkc2hvdEFjY3VyYWN5ID0gMC44OyAvLyAxMDAlIGFjY3VyYWN5IGZvciBoZWFkc2hvdHMKICAgIH0KCiAgICAvLyBNZXRob2QgdG8gZW5hYmxlIEFpbWJvdCBWaXJ0dWFsCiAgICBwdWJsaWMgdm9pZCBFbmFibGVBaW1ib3QoKQogICAgewogICAgICAgIGFpbWJvdEVuYWJsZWQgPSB0cnVlOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJBaW1ib3QgVmlydHVhbCBlbmFibGVkLiBSZWFkeSB0byBhc3Npc3QhIik7CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGRpc2FibGUgQWltYm90IFZpcnR1YWwKICAgIHB1YmxpYyB2b2lkIERpc2FibGVBaW1ib3QoKQogICAgewogICAgICAgIGFpbWJvdEVuYWJsZWQgPSBmYWxzZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQWltYm90IFZpcnR1YWwgZGlzYWJsZWQuIik7CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIHNpbXVsYXRlIGFpbWluZyBhbmQgc2hvb3RpbmcKICAgIHB1YmxpYyB2b2lkIEFpbUFuZFNob290KGludCB0YXJnZXRYLCBpbnQgdGFyZ2V0WSwgaW50IHBsYXllclgsIGludCBwbGF5ZXJZKQogICAgewogICAgICAgIGlmIChhaW1ib3RFbmFibGVkKQogICAgICAgIHsKICAgICAgICAgICAgLy8gU2ltdWxhdGUgYWltaW5nCiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCQiQWltaW5nIGF0IHRhcmdldCAoe3RhcmdldFh9LCB7dGFyZ2V0WX0pLi4uIik7CgogICAgICAgICAgICAvLyBTaW11bGF0ZSBoZWFkc2hvdCBiYXNlZCBvbiBhY2N1cmFjeQogICAgICAgICAgICBpZiAoSXNIZWFkc2hvdCh0YXJnZXRYLCB0YXJnZXRZLCBwbGF5ZXJYLCBwbGF5ZXJZKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkhlYWRzaG90ISBFbmVteSBlbGltaW5hdGVkISIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIk1pc3NlZCB0aGUgaGVhZHNob3QuIEtlZXAgYWltaW5nISIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJBaW1ib3QgVmlydHVhbCBpcyBkaXNhYmxlZC4gTWFudWFsIGFpbWluZyByZXF1aXJlZC4iKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGNoZWNrIGlmIHRoZSBzaG90IGlzIGEgaGVhZHNob3QgYmFzZWQgb24gYWNjdXJhY3kKICAgIHByaXZhdGUgYm9vbCBJc0hlYWRzaG90KGludCB0YXJnZXRYLCBpbnQgdGFyZ2V0WSwgaW50IHBsYXllclgsIGludCBwbGF5ZXJZKQogICAgewogICAgICAgIFJhbmRvbSByYW5kb20gPSBuZXcgUmFuZG9tKCk7CiAgICAgICAgZG91YmxlIGFjY3VyYWN5ID0gcmFuZG9tLk5leHREb3VibGUoKTsKCiAgICAgICAgLy8gU2ltdWxhdGUgYWltYm90IGFjY3VyYWN5IGZvciBoZWFkc2hvdHMKICAgICAgICByZXR1cm4gYWNjdXJhY3kgPD0gaGVhZHNob3RBY2N1cmFjeTsKICAgIH0KfQoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpCiAgICB7CiAgICAgICAgLy8gQ3JlYXRlIGFuIGluc3RhbmNlIG9mIEFpbWJvdFZpcnR1YWwKICAgICAgICBBaW1ib3RWaXJ0dWFsIGFpbWJvdCA9IG5ldyBBaW1ib3RWaXJ0dWFsKCk7CgogICAgICAgIC8vIEVuYWJsZSBBaW1ib3QgVmlydHVhbAogICAgICAgIGFpbWJvdC5FbmFibGVBaW1ib3QoKTsKCiAgICAgICAgLy8gU2ltdWxhdGUgYWltaW5nIGFuZCBzaG9vdGluZwogICAgICAgIGFpbWJvdC5BaW1BbmRTaG9vdCgxNTAsIDIwMCwgMTAwLCAxNTApOwoKICAgICAgICAvLyBEaXNhYmxlIEFpbWJvdCBWaXJ0dWFsCiAgICAgICAgYWltYm90LkRpc2FibGVBaW1ib3QoKTsKCiAgICAgICAgLy8gU2ltdWxhdGUgYWltaW5nIGFuZCBzaG9vdGluZyBhZnRlciBkaXNhYmxpbmcgQWltYm90IFZpcnR1YWwKICAgICAgICBhaW1ib3QuQWltQW5kU2hvb3QoMjAwLCAyNTAsIDE4MCwgMjIwKTsKICAgIH0KfQoKLy8gRGVmaW5lIHRoZSBQbGF5ZXIgY2xhc3MKcHVibGljIGNsYXNzIFBsYXllcgp7CiAgICBwcml2YXRlIGZsb2F0IHg7IC8vIFBsYXllcidzIHgtY29vcmRpbmF0ZQogICAgcHJpdmF0ZSBmbG9hdCB5OyAvLyBQbGF5ZXIncyB5LWNvb3JkaW5hdGUKCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgcHVibGljIFBsYXllcihmbG9hdCB4LCBmbG9hdCB5KQogICAgewogICAgICAgIHRoaXMueCA9IHg7CiAgICAgICAgdGhpcy55ID0geTsKICAgIH0KCiAgICAvLyBNZXRob2QgdG8gZ2V0IHBsYXllcidzIHBvc2l0aW9uCiAgICBwdWJsaWMgVHVwbGU8ZmxvYXQsIGZsb2F0PiBHZXRQb3NpdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuIFR1cGxlLkNyZWF0ZSh4LCB5KTsKICAgIH0KfQoKLy8gRGVmaW5lIHRoZSBFbmVteSBjbGFzcwpwdWJsaWMgY2xhc3MgRW5lbXkKewogICAgcHJpdmF0ZSBmbG9hdCB4OyAvLyBFbmVteSdzIHgtY29vcmRpbmF0ZQogICAgcHJpdmF0ZSBmbG9hdCB5OyAvLyBFbmVteSdzIHktY29vcmRpbmF0ZQoKICAgIC8vIENvbnN0cnVjdG9yCiAgICBwdWJsaWMgRW5lbXkoZmxvYXQgeCwgZmxvYXQgeSkKICAgIHsKICAgICAgICB0aGlzLnggPSB4OwogICAgICAgIHRoaXMueSA9IHk7CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGdldCBlbmVteSdzIHBvc2l0aW9uCiAgICBwdWJsaWMgVHVwbGU8ZmxvYXQsIGZsb2F0PiBHZXRQb3NpdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuIFR1cGxlLkNyZWF0ZSh4LCB5KTsKICAgIH0KfQoKLy8gRGVmaW5lIHRoZSBBaW1ib3QgY2xhc3MKcHVibGljIGNsYXNzIEFpbWJvdAp7CiAgICBwcml2YXRlIGZsb2F0IHN0cmVuZ3RoOyAvLyBTdHJlbmd0aCBvZiB0aGUgYWltYm90ICgwIHRvIDEpCgogICAgLy8gQ29uc3RydWN0b3IKICAgIHB1YmxpYyBBaW1ib3QoZmxvYXQgc3RyZW5ndGgpCiAgICB7CiAgICAgICAgdGhpcy5zdHJlbmd0aCA9IHN0cmVuZ3RoOwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBhaW0gYXQgdGhlIGVuZW15IHdpdGggYSBnaXZlbiBzdHJlbmd0aAogICAgcHVibGljIHZvaWQgQWltQXRFbmVteShQbGF5ZXIgcGxheWVyLCBFbmVteSBlbmVteSkKICAgIHsKICAgICAgICAvLyBHZXQgcGxheWVyJ3MgYW5kIGVuZW15J3MgcG9zaXRpb25zCiAgICAgICAgdmFyIChwbGF5ZXJYLCBwbGF5ZXJZKSA9IHBsYXllci5HZXRQb3NpdGlvbigpOwogICAgICAgIHZhciAoZW5lbXlYLCBlbmVteVkpID0gZW5lbXkuR2V0UG9zaXRpb24oKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhbmdsZSBiZXR3ZWVuIHBsYXllciBhbmQgZW5lbXkKICAgICAgICBmbG9hdCBhbmdsZSA9IChmbG9hdClNYXRoLkF0YW4yKGVuZW15WSAtIHBsYXllclksIGVuZW15WCAtIHBsYXllclgpOwoKICAgICAgICAvLyBBZGp1c3QgdGhlIGFpbSB3aXRoIHRoZSBzdHJlbmd0aAogICAgICAgIGZsb2F0IGFkanVzdGVkQW5nbGUgPSBhbmdsZSArIHN0cmVuZ3RoICogKG5ldyBSYW5kb20oKS5OZXh0KDEwMSkpIC8gMTAwLjBmOwoKICAgICAgICAvLyBPdXRwdXQgdGhlIGFpbWVkIGFuZ2xlCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkFpbSBhZGp1c3RlZCB0byBhbmdsZTogIiArIGFkanVzdGVkQW5nbGUpOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgUHJvZ3JhbQp7CiAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWFpbihzdHJpbmdbXSBhcmdzKQogICAgewogICAgICAgIC8vIENyZWF0ZSBhIHBsYXllciBhbmQgYW4gZW5lbXkKICAgICAgICBQbGF5ZXIgcGxheWVyID0gbmV3IFBsYXllcigxMC4wZiwgMjAuMGYpOwogICAgICAgIEVuZW15IGVuZW15ID0gbmV3IEVuZW15KDMwLjBmLCAxNS4wZik7CgogICAgICAgIC8vIENyZWF0ZSBhbiBhaW1ib3Qgd2l0aCA3MCUgc3RyZW5ndGgKICAgICAgICBBaW1ib3QgYWltYm90ID0gbmV3IEFpbWJvdCgwLjdmKTsKCiAgICAgICAgLy8gQWltIGF0IHRoZSBlbmVteSB3aXRoIHRoZSBhaW1ib3QKICAgICAgICBhaW1ib3QuQWltQXRFbmVteShwbGF5ZXIsIGVuZW15KTsKICAgIH0KfQoKcHVibGljIGNsYXNzIEFpbWluZ0Fzc2lzdGFudAp7CiAgICBwcml2YXRlIGJvb2wgYXV0b0hlYWRzaG90RW5hYmxlZDsKICAgIHByaXZhdGUgaW50IHNlbnNpdGl2aXR5OwoKICAgIHB1YmxpYyBBaW1pbmdBc3Npc3RhbnQoKQogICAgewogICAgICAgIGF1dG9IZWFkc2hvdEVuYWJsZWQgPSBmYWxzZTsKICAgICAgICBzZW5zaXRpdml0eSA9IDk5OTUwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIFNldFNlbnNpdGl2aXR5KGludCBsZXZlbCkKICAgIHsKICAgICAgICBzZW5zaXRpdml0eSA9IE1hdGguTWF4KDAsIE1hdGguTWluKGxldmVsLCA5OTkxMDApKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBBaW1BdFRhcmdldChpbnQgdGFyZ2V0WCwgaW50IHRhcmdldFksIGludCBwbGF5ZXJYLCBpbnQgcGxheWVyWSkKICAgIHsKICAgICAgICBpbnQgZGVsdGFYID0gdGFyZ2V0WCAtIHBsYXllclg7CiAgICAgICAgaW50IGRlbHRhWSA9IHRhcmdldFkgLSBwbGF5ZXJZOwoKICAgICAgICBkZWx0YVggKj0gc2Vuc2l0aXZpdHk7CiAgICAgICAgZGVsdGFZICo9IHNlbnNpdGl2aXR5OwoKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgkIkFkanVzdGVkIGFpbTogKHtkZWx0YVh9LCB7ZGVsdGFZfSkiKTsKCiAgICAgICAgaWYgKGF1dG9IZWFkc2hvdEVuYWJsZWQgJiYgbmV3IFJhbmRvbSgpLk5leHQoMTAwOSkgPCA5OTkwKQogICAgICAgIHsKICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkhlYWRzaG90ISIpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBTZXRBdXRvSGVhZHNob3RFbmFibGVkKGJvb2wgZW5hYmxlZCkKICAgIHsKICAgICAgICBhdXRvSGVhZHNob3RFbmFibGVkID0gZW5hYmxlZDsKICAgIH0KfQoKcHVibGljIGNsYXNzIE1haW5DbGFzcwp7CiAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWFpbihzdHJpbmdbXSBhcmdzKQogICAgewogICAgICAgIEFpbWluZ0Fzc2lzdGFudCBhaW1pbmdBc3Npc3RhbnQgPSBuZXcgQWltaW5nQXNzaXN0YW50KCk7CgogICAgICAgIGFpbWluZ0Fzc2lzdGFudC5TZXRBdXRvSGVhZHNob3RFbmFibGVkKHRydWUpOwogICAgICAgIGFpbWluZ0Fzc2lzdGFudC5TZXRTZW5zaXRpdml0eSgxMDApOwoKICAgICAgICBhaW1pbmdBc3Npc3RhbnQuQWltQXRUYXJnZXQoMTIwLCAyNDAsIDYwLCAxMjApOwoKICAgICAgICAvLyBPdGhlciBjb2RlIGNhbiBiZSBhZGRlZCBoZXJlLi4uCgogICAgfQp9CgpjbGFzcyBQcm9ncmFtCnsKICAgIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykKICAgIHsKICAgICAgICAvLyBIaeG7g24gdGjhu4sgdGjDtG5nIMSRaeG7h3AgIkFpbWJvdCIKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQWltYm90Iik7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3Qga2nhu4N1IGludCB2w6AgZ8OhbiBnacOhIHRy4buLIDEwMCUKICAgICAgICBpbnQgYWltYm90OwogICAgICAgIGFpbWJvdCA9IDEwMDsKCiAgICAgICAgLy8gVOG6oW8gYmnhur9uIGFpbWJvdCB2w6AgZ8OhbiBnacOhIHRy4buLIDEwMCUKICAgICAgICBpbnQgYWltYm90MiA9IDEwMDsKCiAgICAgICAgLy8gSW4gdOG7lW5nIGPhu6dhIGhhaSBiaeG6v24gYWltYm90IHbDoCBhaW1ib3QyCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoYWltYm90ICsgYWltYm90Mik7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3QgdsOgIGFpbWJvdDIga2nhu4N1IGZsb2F0IHbDoCBnw6FuIGdpw6EgdHLhu4sgMTAwMC4wCiAgICAgICAgZmxvYXQgYWltYm90RmxvYXQgPSAxMDAwLjBmOwogICAgICAgIGZsb2F0IGFpbWJvdDJGbG9hdCA9IDEwMDAuMGY7CgogICAgICAgIC8vIEluIHThu5VuZyBj4bunYSBoYWkgYmnhur9uIGFpbWJvdEZsb2F0IHbDoCBhaW1ib3QyRmxvYXQKICAgICAgICBDb25zb2xlLldyaXRlTGluZShhaW1ib3RGbG9hdCArIGFpbWJvdDJGbG9hdCk7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3Qga2nhu4N1IGJvb2wgdsOgIGfDoW4gZ2nDoSB0cuG7iyB0cnVlCiAgICAgICAgYm9vbCBhaW1ib3RCb29sID0gdHJ1ZTsKCiAgICAgICAgLy8gR8OhbiBnacOhIHRy4buLIGPhu6dhIGJp4bq_biBhaW1ib3RCb29sIGNobyBiaeG6v24gYWN0aW9uIGtp4buDdSBjaGFyCiAgICAgICAgY2hhciBhY3Rpb24gPSBhaW1ib3RCb29sID8gJzEnIDogJzAnOwoKICAgICAgICAvLyBU4bqhbyBiaeG6v24gYWltYm90IGtp4buDdSBpbnQgdsOgIGfDoW4gZ2nDoSB0cuG7iyAxMDAlCiAgICAgICAgaW50IGFpbWJvdEludCA9IDEwMDsKCiAgICAgICAgLy8gR8OhbiBnacOhIHRy4buLIGPhu6dhIGJp4bq_biBhaW1ib3RJbnQgY2hvIGJp4bq_biBhY3Rpb24ga2nhu4N1IGNoYXIKICAgICAgICBjaGFyIGFjdGlvbjIgPSAoY2hhcilhaW1ib3RJbnQ7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3Qga2nhu4N1IGRvdWJsZSB2w6AgZ8OhbiBnacOhIHRy4buLIDEwMDAuMAogICAgICAgIGRvdWJsZSBhaW1ib3REb3VibGUgPSAxMDAwLjA7CgogICAgICAgIC8vIEluIGdpw6EgdHLhu4sgY-G7p2EgYmnhur9uIGFpbWJvdERvdWJsZQogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJ2YWxvciBkbyBhaW1ib3Q6ICIgKyBhaW1ib3REb3VibGUpOwoKICAgICAgICAvLyBJbiBnacOhIHRy4buLIGPhu6dhIGJp4bq_biBhY3Rpb24yCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoImHDp8OjbyBzZW5kbyBleGVjdXRhZGE6ICIgKyBhY3Rpb24yKTsKCiAgICAgICAgLy8gSW4gZ2nDoSB0cuG7iyBj4bunYSBiaeG6v24gYWltYm90RG91YmxlCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoInZhbG9yIGRvIGZsdXR1YW50ZSBhaW1ib3Q6ICIgKyBhaW1ib3REb3VibGUpOwoKICAgICAgICAvLyBJbiBnacOhIHRy4buLIGPhu6dhIGJp4bq_biBhaW1ib3RJbnQKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiZGVmaW5pciB2YWxvciBkbyBhaW1ib3Q6ICIgKyBhaW1ib3RJbnQpOwoKICAgICAgICAvLyBJbiBnacOhIHRy4buLIGPhu6dhIGJp4bq_biBhY3Rpb24yCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoImRlZmluaXIgdmFsb3IgZGEgYcOnw6NvOiAiICsgYWN0aW9uMik7CgogICAgICAgIC8vIEluIGdpw6EgdHLhu4sgY-G7p2EgYmnhur9uIGFpbWJvdERvdWJsZQogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJkZWZpbmlyIHZhbG9yIGRvIGZsdXR1YW50ZSBhaW1ib3Q6ICIgKyAxMDAwLjApOwoKICAgICAgICAvLyBJbiBnacOhIHRy4buLIGPhu6dhIGJp4bq_biBhaW1ib3RJbnQgdsOgIGFpbWJvdDIKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiYWltYm90ICIpOwoKICAgICAgICAvLyBJbiB04buVbmcgY-G7p2EgaGFpIGJp4bq_biBhaW1ib3RJbnQgdsOgIGFpbWJvdDIKICAgICAgICBDb25zb2xlLldyaXRlTGluZShhaW1ib3RJbnQgKyBhaW1ib3QyKTsKCiAgICAgICAgLy8gTmjhuq1wIGdpw6EgdHLhu4sgY2hvIGJp4bq_biBhaW1ib3RJbnQgdOG7qyBiw6BuIHBow61tCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoImRlZmluaXIgdmFsb3IgZG8gYWltYm90OiAiKTsKICAgICAgICBhaW1ib3RJbnQgPSBDb252ZXJ0LlRvSW50MzIoQ29uc29sZS5SZWFkTGluZSgpKTsKCiAgICAgICAgLy8gSW4gZ2nDoSB0cuG7iyBj4bunYSBiaeG6v24gYWltYm90SW50CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoInZhbG9yIGRvIGFpbWJvdCDDqTogIiArIGFpbWJvdEludCk7CgogICAgICAgIC8vIEluIGdpw6EgdHLhu4sgY-G7p2EgYmnhur9uIGFpbWJvdEludAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKGFpbWJvdEludCArIGFpbWJvdCk7CgogICAgICAgIC8vIE5o4bqtcCBnacOhIHRy4buLIGNobyBiaeG6v24gYWltYm90SW50IHThu6sgYsOgbiBwaMOtbQogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJkZWZpbmlyIHZhbG9yIGRvIGFpbWJvdDogIik7CiAgICAgICAgYWltYm90SW50ID0gQ29udmVydC5Ub0ludDMyKENvbnNvbGUuUmVhZExpbmUoKSk7CgogICAgICAgIC8vIE5o4bqtcCBnacOhIHRy4buLIGNobyBiaeG6v24gYWltYm90MiB04burIGLDoG4gcGjDrW0KICAgICAgICBDb25zb2xlLldyaXRlTGluZSgib3V0cm8gdmFsb3IgcGFyYSBhaW1ib3Q6ICIpOwogICAgICAgIGludCBhaW1ib3QySW50ID0gQ29udmVydC5Ub0ludDMyKENvbnNvbGUuUmVhZExpbmUoKSk7CgogICAgICAgIC8vIEluIHThu5VuZyBj4bunYSBoYWkgYmnhur9uIGFpbWJvdEludCB2w6AgYWltYm90MkludAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJvIHZhbG9yIGRvIGFpbWJvdCDDqTogIiArIChhaW1ib3RJbnQgKyBhaW1ib3QySW50KSk7CgogICAgICAgIC8vIEluIHThu5VuZyBj4bunYSBoYWkgYmnhur9uIGFpbWJvdEludCB2w6AgYWltYm90MkludAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKGFpbWJvdEludCArIGFpbWJvdDJJbnQpOwoKICAgICAgICAvLyBU4bqhbyBiaeG6v24gYWltYm90IGtp4buDdSBpbnQgdsOgIGfDoW4gZ2nDoSB0cuG7iyAxMDAlCiAgICAgICAgaW50IGFpbWJvdDMgPSAxMDA7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3QyIGtp4buDdSBsb25nIHbDoCBnw6FuIGdpw6EgdHLhu4sgMTAwJQogICAgICAgIGxvbmcgYWltYm90MkxvbmcgPSAxMDA7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3QzIGtp4buDdSBpbnQgdsOgIGfDoW4gZ2nDoSB0cuG7iyArMTAwJQogICAgICAgIGludCBhaW1ib3QzSW50ID0gKzEwMDsKCiAgICAgICAgLy8gSW4ga8OtY2ggdGjGsOG7m2MgY-G7p2EgYmnhur9uIGFpbWJvdEludAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKHNpemVvZihpbnQpICsgMTAwMCk7CgogICAgICAgIC8vIEluIGvDrWNoIHRoxrDhu5tjIGPhu6dhIGJp4bq_biBhaW1ib3QyTG9uZwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKHNpemVvZihsb25nKSArIDEwMDApOwoKICAgICAgICAvLyBJbiBrw61jaCB0aMaw4bubYyBj4bunYSBiaeG6v24gYWltYm90M0ludAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKHNpemVvZihpbnQpICsgMTAwMCk7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3Qga2nhu4N1IGludCB2w6AgZ8OhbiBnacOhIHRy4buLIDk1JQogICAgICAgIGludCBhaW1ib3Q0ID0gOTU7CgogICAgICAgIC8vIFThuqFvIGJp4bq_biBhaW1ib3QyIGtp4buDdSBzaWduZWQgaW50IHbDoCBnw6FuIGdpw6EgdHLhu4sgKzk1JQogICAgICAgIGludCBhaW1ib3QyU2lnbmVkID0gKzk1OwoKICAgICAgICAvLyBU4bqhbyBiaeG6v24gYWltYm90MyBraeG7g3UgbG9uZyB2w6AgZ8OhbiBnacOhIHRy4buLIDk1JQogICAgICAgIGxvbmcgYWltYm90M0xvbmcgPSA5NTsKCiAgICAgICAgLy8gSW4ga8OtY2ggdGjGsOG7m2MgY-G7p2EgYmnhur9uIGFpbWJvdDQKICAgICAgICBDb25zb2xlLldyaXRlTGluZShzaXplb2YoaW50KSArICJpZ3VhbCIgKyA5NSk7CgogICAgICAgIC8vIEluIGvDrWNoIHRoxrDhu5tjIGPhu6dhIGJp4bq_biBhaW1ib3QyU2lnbmVkCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoc2l6ZW9mKGludCkgKyAiaWd1YWwiICsgOTUpOwoKICAgICAgICAvLyBJbiBrw61jaCB0aMaw4bubYyBj4bunYSBiaeG6v24gYWltYm90M0xvbmcKICAgICAgICBDb25zb2xlLldyaXRlTGluZShzaXplb2YobG9uZykgKyAiaWd1YWwiICsgOTUpOwoKICAgICAgICAvLyBJbiBrw61jaCB0aMaw4bubYyBj4bunYSBiaeG6v24gYWltYm90NAogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKHNpemVvZihpbnQpICsgInRhbWFuaG8iICsgMTAwMCk7CgogICAgICAgIC8vIEluIGvDrWNoIHRoxrDhu5tjIGPhu6dhIGJp4bq_biBhaW1ib3QyU2lnbmVkCiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoc2l6ZW9mKGludCkgKyAiCgpwdWJsaWMgY2xhc3MgQWltTG9ja2VyCnsKICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIEFpbUxvY2tIZWFkQWxsKHN0cmluZyB3ZWFwb24pCiAgICB7CiAgICAgICAgaWYgKHdlYXBvbiA9PSAiOTAlIikKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAiQWltIGxvY2sgYWN0aXZhdGVkIHdpdGggOTAlIGFjY3VyYWN5IGZvciBoZWFkc2hvdHMgb24gYWxsIGVuZW1pZXMuIjsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICJJbnZhbGlkIHdlYXBvbi4gQWltIGxvY2sgZmFpbGVkLiI7CiAgICAgICAgfQogICAgfQp9CgpwdWJsaWMgY2xhc3MgUHJvZ3JhbQp7CiAgICBwdWJsaWMgc3RhdGljIGJvb2wgQWltTG9jazkwKGRvdWJsZSBkaXN0YW5jZSwgZG91YmxlIHdlYXBvbkFjY3VyYWN5LCBkb3VibGUgaGVhZHNob3RQZXJjZW50YWdlKQogICAgewogICAgICAgIGRvdWJsZSBoaXRQcm9iYWJpbGl0eSA9IHdlYXBvbkFjY3VyYWN5IC8gZGlzdGFuY2U7CiAgICAgICAgZG91YmxlIGhlYWRzaG90Q2hhbmNlID0gaGl0UHJvYmFiaWxpdHkgKiBoZWFkc2hvdFBlcmNlbnRhZ2U7CiAgICAgICAgZG91YmxlIHJhbmRvbSA9IG5ldyBSYW5kb20oKS5OZXh0RG91YmxlKCk7CgogICAgICAgIHJldHVybiByYW5kb20gPD0gaGVhZHNob3RDaGFuY2U7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykKICAgIHsKICAgICAgICAvLyBFeGFtcGxlIHVzYWdlIG9mIEFpbUxvY2tlciBjbGFzcwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKEFpbUxvY2tlci5BaW1Mb2NrSGVhZEFsbCgiOTAlIikpOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKEFpbUxvY2tlci5BaW1Mb2NrSGVhZEFsbCgiTTRBMSIpKTsKCiAgICAgICAgLy8gRXhhbXBsZSB1c2FnZSBvZiBBaW1Mb2NrOTAgZnVuY3Rpb24KICAgICAgICBkb3VibGUgZGlzdGFuY2UgPSAxNS4wOwogICAgICAgIGRvdWJsZSB3ZWFwb25BY2N1cmFjeSA9IDAuNzsKICAgICAgICBkb3VibGUgaGVhZHNob3RQZXJjZW50YWdlID0gMC45MDsKCiAgICAgICAgYm9vbCBpc0hlYWRzaG90ID0gQWltTG9jazkwKGRpc3RhbmNlLCB3ZWFwb25BY2N1cmFjeSwgaGVhZHNob3RQZXJjZW50YWdlKTsKCiAgICAgICAgaWYgKGlzSGVhZHNob3QpCiAgICAgICAgewogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQWltIGxvY2sgaGVhZHNob3Qgc3VjY2Vzc2Z1bCEiKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkFpbSBsb2NrIGhlYWRzaG90IG1pc3NlZCEiKTsKICAgICAgICB9CiAgICB9Cn1pbmNsdWRlIDxpb3N0cmVhbT4KI2luY2x1ZGUgPG1hcD4KI2luY2x1ZGUgPHN0cmluZz4KI2luY2x1ZGUgPHZhcmlhbnQ-CiNpbmNsdWRlIDxvcHRpb25hbD4KCmNsYXNzIFNldHRpbmdzTWFuYWdlciB7CnB1YmxpYzoKICAgIHVzaW5nIFNldHRpbmdWYWx1ZSA9IHN0ZDo6dmFyaWFudDxpbnQsIGJvb2wsIHN0ZDo6c3RyaW5nPjsKCiAgICB2b2lkIHNldFNldHRpbmcoY29uc3Qgc3RkOjpzdHJpbmcmIGtleSwgU2V0dGluZ1ZhbHVlIHZhbHVlKSB7CiAgICAgICAgc2V0dGluZ3Nba2V5XSA9IHN0ZDo6bW92ZSh2YWx1ZSk7CiAgICB9CgogICAgc3RkOjpvcHRpb25hbDxTZXR0aW5nVmFsdWU-IGdldFNldHRpbmcoY29uc3Qgc3RkOjpzdHJpbmcmIGtleSkgY29uc3QgewogICAgICAgIGF1dG8gaXQgPSBzZXR0aW5ncy5maW5kKGtleSk7CiAgICAgICAgaWYgKGl0ICE9IHNldHRpbmdzLmVuZCgpKSB7CiAgICAgICAgICAgIHJldHVybiBpdC0-c2Vjb25kOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RkOjpudWxsb3B0OwogICAgfQoKICAgIHZvaWQgYXBwbHlTZXR0aW5ncygpIHsKICAgICAgICBpZiAoYXV0byBzZXR0aW5nID0gZ2V0U2V0dGluZygiY29tLnB0c3BlZWRfbGFkYl9hbGxvdy5saXN0IikpIHsKICAgICAgICAgICAgaWYgKHN0ZDo6Z2V0PGludD4oKnNldHRpbmcpID09IDcpIHsKICAgICAgICAgICAgICAgIHN0ZDo6Y291dCA8PCAiU3BlZWQgTEFEQiBhbGxvdyBsaXN0IGlzIHNldCB0byA3LiIgPDwgc3RkOjplbmRsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYXV0byBzZXR0aW5nID0gZ2V0U2V0dGluZygiY29tLnB0c3BlZWRfbGFkYl9hbGxvd19lbmFibGVkIikpIHsKICAgICAgICAgICAgaWYgKHN0ZDo6Z2V0PGJvb2w-KCpzZXR0aW5nKSkgewogICAgICAgICAgICAgICAgc3RkOjpjb3V0IDw8ICJMQURCIGFsbG93IGlzIGVuYWJsZWQuIiA8PCBzdGQ6OmVuZGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGQ6OmNvdXQgPDwgIkxBREIgYWxsb3cgaXMgZGlzYWJsZWQuIiA8PCBzdGQ6OmVuZGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgdm9pZCBkaXNwbGF5U2V0dGluZ3MoKSBjb25zdCB7CiAgICAgICAgc3RkOjpjb3V0IDw8ICJDdXJyZW50IFNldHRpbmdzOiIgPDwgc3RkOjplbmRsOwogICAgICAgIGZvciAoY29uc3QgYXV0byYgW2tleSwgdmFsdWVdIDogc2V0dGluZ3MpIHsKICAgICAgICAgICAgc3RkOjpjb3V0IDw8ICJLZXk6ICIgPDwga2V5IDw8ICIgLT4gVmFsdWU6ICI7CiAgICAgICAgICAgIHN0ZDo6dmlzaXQoW10oYXV0byYmIHZhbCkgeyBzdGQ6OmNvdXQgPDwgdmFsIDw8IHN0ZDo6ZW5kbDsgfSwgdmFsdWUpOwogICAgICAgIH0KICAgIH0KCnByaXZhdGU6CiAgICBzdGQ6Om1hcDxzdGQ6OnN0cmluZywgU2V0dGluZ1ZhbHVlPiBzZXR0aW5nczsKfTsKCmludCBtYWluKCkgewogICAgU2V0dGluZ3NNYW5hZ2VyIHNldHRpbmdzTWFuYWdlcjsKCiAgICAvLyBTZXR0aW5nIGFjY29yZGluZyB0byB0aGUgcHJvdmlkZWQgY29uZmlndXJhdGlvbgogICAgc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoImNvbS5wdHNwZWVkX2xhZGJfYWxsb3cubGlzdCIsIDcpOwogICAgc2V0dGluZ3NNYW5hZ2VyLnNldFNldHRpbmcoImNvbS5wdHNwZWVkX2xhZGJfYWxsb3dfZW5hYmxlZCIsIHRydWUpOwoKICAgIHNldHRpbmdzTWFuYWdlci5hcHBseVNldHRpbmdzKCk7CiAgICBzZXR0aW5nc01hbmFnZXIuZGlzcGxheVNldHRpbmdzKCk7CgogICAgcmV0dXJuIDA7Cn0KCnB1YmxpYyBjbGFzcyBIZWFkVHJhY2tpbmdDb250cm9sbGVyCnsKICAgIHByaXZhdGUgYm9vbCBoZWFkVHJhY2tpbmdFbmFibGVkOwoKICAgIHB1YmxpYyBIZWFkVHJhY2tpbmdDb250cm9sbGVyKCkKICAgIHsKICAgICAgICBoZWFkVHJhY2tpbmdFbmFibGVkID0gZmFsc2U7CiAgICB9CgogICAgcHVibGljIHZvaWQgRW5hYmxlSGVhZFRyYWNraW5nKCkKICAgIHsKICAgICAgICBoZWFkVHJhY2tpbmdFbmFibGVkID0gdHJ1ZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSGVhZCB0cmFja2luZyBlbmFibGVkLiBUYXJnZXRpbmcgaGVhZHNob3RzISIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIERpc2FibGVIZWFkVHJhY2tpbmcoKQogICAgewogICAgICAgIGhlYWRUcmFja2luZ0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSGVhZCB0cmFja2luZyBkaXNhYmxlZC4iKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBTaG9vdCgpCiAgICB7CiAgICAgICAgaWYgKGhlYWRUcmFja2luZ0VuYWJsZWQpCiAgICAgICAgewogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSGVhZHNob3QhIFByZWNpc2UgdGFyZ2V0aW5nLiIpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiTm9ybWFsIHNob3QuIEtlZXAgYWltaW5nISIpOwogICAgICAgIH0KICAgIH0KfQoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpCiAgICB7CiAgICAgICAgLy8gVOG6oW8gbeG7mXQgdGjhu4MgaGnhu4duIGPhu6dhIEhlYWRUcmFja2luZ0NvbnRyb2xsZXIKICAgICAgICBIZWFkVHJhY2tpbmdDb250cm9sbGVyIHRyYWNraW5nQ29udHJvbGxlciA9IG5ldyBIZWFkVHJhY2tpbmdDb250cm9sbGVyKCk7CgogICAgICAgIC8vIELhuq10IGLDoW0gY2jhurd0IHTDom0g4bufIHbDuW5nIMSR4bqndQogICAgICAgIHRyYWNraW5nQ29udHJvbGxlci5FbmFibGVIZWFkVHJhY2tpbmcoKTsKCiAgICAgICAgLy8gTcO0IHBo4buPbmcgdmnhu4djIGLhuq9uCiAgICAgICAgdHJhY2tpbmdDb250cm9sbGVyLlNob290KCk7CgogICAgICAgIC8vIFThuq90IGLDoW0gY2jhurd0IHTDom0g4bufIHbDuW5nIMSR4bqndQogICAgICAgIHRyYWNraW5nQ29udHJvbGxlci5EaXNhYmxlSGVhZFRyYWNraW5nKCk7CgogICAgICAgIC8vIE3DtCBwaOG7j25nIHZp4buHYyBi4bqvbiBzYXUga2hpIHThuq90IGLDoW0gY2jhurd0IHTDom0g4bufIHbDuW5nIMSR4bqndQogICAgICAgIHRyYWNraW5nQ29udHJvbGxlci5TaG9vdCgpOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgU2Vuc2l0aXZpdHlDb25maWcKewogICAgcHJpdmF0ZSBpbnQgc2Vuc2l0aXZpdHlUaHJlc2hvbGQ7CgogICAgcHVibGljIFNlbnNpdGl2aXR5Q29uZmlnKGludCB0aHJlc2hvbGQpCiAgICB7CiAgICAgICAgc2Vuc2l0aXZpdHlUaHJlc2hvbGQgPSB0aHJlc2hvbGQ7CiAgICB9CgogICAgcHVibGljIGJvb2wgSXNTZW5zaXRpdml0eUFib3ZlVGhyZXNob2xkKGludCBjdXJyZW50U2Vuc2l0aXZpdHkpCiAgICB7CiAgICAgICAgcmV0dXJuIGN1cnJlbnRTZW5zaXRpdml0eSA-IHNlbnNpdGl2aXR5VGhyZXNob2xkOwogICAgfQp9CgpwdWJsaWMgY2xhc3MgUHJvZ3JhbQp7CiAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWFpbihzdHJpbmdbXSBhcmdzKQogICAgewogICAgICAgIC8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBTZW5zaXRpdml0eUNvbmZpZyB3aXRoIGEgdGhyZXNob2xkIG9mIDEyMjAKICAgICAgICBTZW5zaXRpdml0eUNvbmZpZyBjb25maWcgPSBuZXcgU2Vuc2l0aXZpdHlDb25maWcoMTIyMCk7CgogICAgICAgIC8vIEFzc3VtZSBzb21lIHZhcmlhYmxlIHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBzZW5zaXRpdml0eSB2YWx1ZQogICAgICAgIGludCBjdXJyZW50U2Vuc2l0aXZpdHkgPSAxMzAwOwoKICAgICAgICBpZiAoY29uZmlnLklzU2Vuc2l0aXZpdHlBYm92ZVRocmVzaG9sZChjdXJyZW50U2Vuc2l0aXZpdHkpKQogICAgICAgIHsKICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlNlbnNpdGl2aXR5IGlzIGFib3ZlIHRoZSB0aHJlc2hvbGQuIik7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJTZW5zaXRpdml0eSBpcyBub3QgYWJvdmUgdGhlIHRocmVzaG9sZC4iKTsKICAgICAgICB9CgogICAgICAgIC8vIEFkZCBtb3JlIGxvZ2ljIGFuZCB2YXJpYWJsZXMgYXMgbmVlZGVkCiAgICB9Cn0KCi8vIENsYXNzIFBsYXllcgpjbGFzcyBQbGF5ZXIKewogICAgcHJpdmF0ZSBzdHJpbmcgcGxheWVyTmFtZTsKCiAgICBwdWJsaWMgUGxheWVyKHN0cmluZyBuYW1lKQogICAgewogICAgICAgIHBsYXllck5hbWUgPSBuYW1lOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIERyYWdIZWFkc2hvdDkwKFBsYXllciB0YXJnZXQpCiAgICB7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoJCJ7cGxheWVyTmFtZX0gcGVyZm9ybXMgYSBEcmFnIEhlYWRzaG90IDkwJSBvbiB7dGFyZ2V0LkdldFBsYXllck5hbWUoKX0uIik7CiAgICAgICAgLy8gUGVyZm9ybSB0aGUgZHJhZyBoZWFkc2hvdCBhY3Rpb24gd2l0aCA5MCUgYWNjdXJhY3kKICAgIH0KCiAgICBwdWJsaWMgc3RyaW5nIEdldFBsYXllck5hbWUoKQogICAgewogICAgICAgIHJldHVybiBwbGF5ZXJOYW1lOwogICAgfQp9CgovLyBOYW1lc3BhY2UgRnJlZUZpcmVVdGlscyB3aXRoIG5lc3RlZCBjbGFzcyBBdXRvSGVhZApuYW1lc3BhY2UgRnJlZUZpcmVVdGlscwp7CiAgICBjbGFzcyBBdXRvSGVhZAogICAgewogICAgICAgIHByaXZhdGUgUmFuZG9tIHJhbmRvbSA9IG5ldyBSYW5kb20oKTsKCiAgICAgICAgcHVibGljIGludCBHZW5lcmF0ZVJhbmRvbU51bWJlcigpCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gcmFuZG9tLk5leHQoMSwgMTAxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sIEFjdGl2YXRlQXV0b0hlYWRzaG90KCkKICAgICAgICB7CiAgICAgICAgICAgIGludCByYW5kb21OdW1iZXIgPSBHZW5lcmF0ZVJhbmRvbU51bWJlcigpOwogICAgICAgICAgICBpZiAocmFuZG9tTnVtYmVyIDw9IDkwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQXV0byBoZWFkc2hvdCBhY3RpdmF0ZWQhIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJBdXRvIGhlYWRzaG90IGZhaWxlZC4iKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLy8gTmFtZXNwYWNlIEZyZWVGaXJlVXRpbHMgd2l0aCBuZXN0ZWQgY2xhc3MgRnJlZUZpcmVIZWFkc2hvdApuYW1lc3BhY2UgRnJlZUZpcmVVdGlscwp7CiAgICBjbGFzcyBGcmVlRmlyZUhlYWRzaG90CiAgICB7CiAgICAgICAgcHJpdmF0ZSBSYW5kb20gcmFuZG9tID0gbmV3IFJhbmRvbSgpOwoKICAgICAgICBwdWJsaWMgaW50IEdlbmVyYXRlUmFuZG9tTnVtYmVyKCkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiByYW5kb20uTmV4dCgxLCAxMDEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0cmluZyBTaW11bGF0ZUhlYWRzaG90V2l0aFBsYXllcihzdHJpbmcgcGxheWVyTmFtZSwgc3RyaW5nIHZpY3RpbU5hbWUpCiAgICAgICAgewogICAgICAgICAgICBpbnQgcmFuZG9tUGVyY2VudGFnZSA9IEdlbmVyYXRlUmFuZG9tTnVtYmVyKCk7CiAgICAgICAgICAgIGlmIChyYW5kb21QZXJjZW50YWdlIDw9IDkwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXR1cm4gJCJ7cGxheWVyTmFtZX0gcGVyZm9ybWVkIGEgaGVhZHNob3QgKDkwJSkgb24ge3ZpY3RpbU5hbWV9IGluIEZyZWUgRmlyZSEiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuICQie3BsYXllck5hbWV9IGF0dGVtcHRlZCBhIGhlYWRzaG90IG9uIHt2aWN0aW1OYW1lfSwgYnV0IG1pc3NlZC4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpjbGFzcyBQcm9ncmFtCnsKICAgIC8vIEZ1bmN0aW9uIHRvIGNvbmZpZ3VyZSBhdXRvIGhlYWRzaG90IHdpdGggOTAlIGFjY3VyYWN5IGluIEZyZWUgRmlyZQogICAgc3RhdGljIHN0cmluZyBDb25maWd1cmVBdXRvSGVhZHNob3Qoc3RyaW5nIGNvbmZpZykKICAgIHsKICAgICAgICBpZiAoY29uZmlnID09ICJhdXRvIGhlYWRzaG90IGZyZWUgZmlyZSIpCiAgICAgICAgewogICAgICAgICAgICAvLyBDb2RlIHRvIGNvbmZpZ3VyZSBhdXRvIGhlYWRzaG90IHdpdGggOTAlIGFjY3VyYWN5IGluIEZyZWUgRmlyZQogICAgICAgICAgICAvLyAuLi4KCiAgICAgICAgICAgIHJldHVybiAiQXV0byBoZWFkc2hvdCBjb25maWd1cmVkIHdpdGggOTAlIGFjY3VyYWN5IHN1Y2Nlc3NmdWxseS4iOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gIkludmFsaWQgY29uZmlndXJhdGlvbi4iOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpCiAgICB7CiAgICAgICAgLy8gRXhhbXBsZSB1c2FnZSBmb3IgQ29uZmlndXJlQXV0b0hlYWRzaG90IGZ1bmN0aW9uCiAgICAgICAgc3RyaW5nIGNvbmZpZzEgPSAiYXV0byBoZWFkc2hvdCBmcmVlIGZpcmUiOwogICAgICAgIHN0cmluZyByZXN1bHQxID0gQ29uZmlndXJlQXV0b0hlYWRzaG90KGNvbmZpZzEpOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKHJlc3VsdDEpOwoKICAgICAgICAvLyBDcmVhdGUgdHdvIHBsYXllcnMKICAgICAgICBQbGF5ZXIgcGxheWVyMSA9IG5ldyBQbGF5ZXIoIkpvaG4iKTsKICAgICAgICBQbGF5ZXIgcGxheWVyMiA9IG5ldyBQbGF5ZXIoIkFsaWNlIik7CgogICAgICAgIC8vIFBlcmZvcm0gYSBkcmFnIGhlYWRzaG90IGFjdGlvbiB3aXRoIDkwJSBhY2N1cmFjeQogICAgICAgIHBsYXllcjEuRHJhZ0hlYWRzaG90OTAocGxheWVyMik7CgogICAgICAgIC8vIEV4YW1wbGU6IEZyZWUgRmlyZSBBdXRvIEhlYWRzaG90CiAgICAgICAgLy8gVXNlIHRoZSBBdXRvSGVhZCBjbGFzcyB0byBhY3RpdmF0ZSB0aGUgYXV0byBoZWFkc2hvdCBjb2RlCiAgICAgICAgewogICAgICAgICAgICBGcmVlRmlyZVV0aWxzLkF1dG9IZWFkIGF1dG9IZWFkc2hvdCA9IG5ldyBGcmVlRmlyZVV0aWxzLkF1dG9IZWFkKCk7CiAgICAgICAgICAgIGJvb2wgaXNBdXRvSGVhZHNob3RTdWNjZXNzZnVsID0gYXV0b0hlYWRzaG90LkFjdGl2YXRlQXV0b0hlYWRzaG90KCk7CgogICAgICAgICAgICBpZiAoaXNBdXRvSGVhZHNob3RTdWNjZXNzZnVsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiWW91IGdvdCBhIGhlYWRzaG90ISIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIllvdSBtaXNzZWQgdGhlIGhlYWRzaG90LiIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBFeGFtcGxlOiBTaW11bGF0ZSBhIGhlYWRzaG90IHdpdGggOTAlIGFjY3VyYWN5CiAgICAgICAgLy8gVXNlIHRoZSBGcmVlRmlyZUhlYWRzaG90IGNsYXNzIHRvIHNpbXVsYXRlIGEgaGVhZHNob3QKICAgICAgICB7CiAgICAgICAgICAgIEZyZWVGaXJlVXRpbHMuRnJlZUZpcmVIZWFkc2hvdCBoZWFkc2hvdFNpbXVsYXRvciA9IG5ldyBGcmVlRmlyZVV0aWxzLkZyZWVGaXJlSGVhZHNob3QoKTsKICAgICAgICAgICAgc3RyaW5nIHBsYXllciA9ICJKb2huIjsKICAgICAgICAgICAgc3RyaW5nIHZpY3RpbSA9ICJKYW5lIjsKCiAgICAgICAgICAgIHN0cmluZyBoZWFkc2hvdE1lc3NhZ2UgPSBoZWFkc2hvdFNpbXVsYXRvci5TaW11bGF0ZUhlYWRzaG90V2l0aFBsYXllcihwbGF5ZXIsIHZpY3RpbSk7CiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKGhlYWRzaG90TWVzc2FnZSk7CiAgICAgICAgfQogICAgfQp9LyogY29tLmFsbG93X2NvbmZfc2VjbGVjdF9zeXNfc3luYwpwYWNrYWdlIGNvbS5hbmRyb2lkLnNldHRpbmdzOwoKaW1wb3J0IGFuZHJvaWQuYXBwLkFjdGl2aXR5OwppbXBvcnQgYW5kcm9pZC5jb250ZW50LkFjdGl2aXR5Tm90Rm91bmRFeGNlcHRpb247CmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuSW50ZW50OwppbXBvcnQgYW5kcm9pZC5jb250ZW50LnJlcy5SZXNvdXJjZXM7CmltcG9ydCBhbmRyb2lkLm5ldC5Vcmk7CmltcG9ydCBhbmRyb2lkLm9zLkJ1bmRsZTsKaW1wb3J0IGFuZHJvaWQudXRpbC5Mb2c7CmltcG9ydCBhbmRyb2lkLndpZGdldC5Ub2FzdDsKCmltcG9ydCBqYXZhLmlvLkZpbGU7CgovKioKICogVGhlICJkaWFsb2ciIHRoYXQgc2hvd3MgZnJvbSAiTWFudWFsIiBpbiB0aGUgU2V0dGluZ3MgYXBwLgogKi8KcHVibGljIGNsYXNzIE1hbnVhbERpc3BsYXlBY3Rpdml0eSBleHRlbmRzIEFjdGl2aXR5IHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBUQUcgPSAiU2V0dGluZ3NNYW51YWxBY3Rpdml0eSI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIE1BTlVBTF9QQVRIID0gIi9zeXN0ZW0vZXRjL01BTlVBTC5odG1sLmd6IjsKCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG9uQ3JlYXRlKEJ1bmRsZSBzYXZlZEluc3RhbmNlU3RhdGUpIHsKICAgICAgICBzdXBlci5vbkNyZWF0ZShzYXZlZEluc3RhbmNlU3RhdGUpOwogICAgICAgIFJlc291cmNlcyByZXNvdXJjZXMgPSBnZXRSZXNvdXJjZXMoKTsKCiAgICAgICAgaWYgKCFyZXNvdXJjZXMuZ2V0Qm9vbGVhbihSLmJvb2wuY29uZmlnX3Nob3dfbWFudWFsKSkgewogICAgICAgICAgICBmaW5pc2goKTsgICAvLyBObyBtYW51YWwgdG8gZGlzcGxheSBmb3IgdGhpcyBkZXZpY2UKICAgICAgICB9CgogICAgICAgIGZpbmFsIEZpbGUgZmlsZSA9IG5ldyBGaWxlKE1BTlVBTF9QQVRIKTsKICAgICAgICBpZiAoIWZpbGUuZXhpc3RzKCkgfHwgZmlsZS5sZW5ndGgoKSA9PSAwKSB7CiAgICAgICAgICAgIExvZy5lKFRBRywgIk1hbnVhbCBmaWxlICIgKyBNQU5VQUxfUEFUSCArICIgZG9lcyBub3QgZXhpc3QiKTsKICAgICAgICAgICAgc2hvd0Vycm9yQW5kRmluaXNoKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZpbmFsIEludGVudCBpbnRlbnQgPSBuZXcgSW50ZW50KEludGVudC5BQ1RJT05fVklFVyk7CiAgICAgICAgaW50ZW50LnNldERhdGFBbmRUeXBlKFVyaS5mcm9tRmlsZShmaWxlKSwgInRleHQvaHRtbCIpOwoKICAgICAgICBpbnRlbnQucHV0RXh0cmEoSW50ZW50LkVYVFJBX1RJVExFLCBnZXRTdHJpbmcoUi5zdHJpbmcuc2V0dGluZ3NfbWFudWFsX2FjdGl2aXR5X3RpdGxlKSk7CiAgICAgICAgaW50ZW50LmFkZENhdGVnb3J5KEludGVudC5DQVRFR09SWV9ERUZBVUxUKTsKICAgICAgICBpbnRlbnQuc2V0UGFja2FnZSgiY29tLmFuZHJvaWQuaHRtbHZpZXdlciIpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBzdGFydEFjdGl2aXR5KGludGVudCk7CiAgICAgICAgICAgIGZpbmlzaCgpOwogICAgICAgIH0gY2F0Y2ggKEFjdGl2aXR5Tm90Rm91bmRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMb2cuZShUQUcsICJGYWlsZWQgdG8gZmluZCB2aWV3ZXIiLCBlKTsKICAgICAgICAgICAgc2hvd0Vycm9yQW5kRmluaXNoKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzaG93RXJyb3JBbmRGaW5pc2goKSB7CiAgICAgICAgVG9hc3QubWFrZVRleHQodGhpcywgUi5zdHJpbmcuc2V0dGluZ3NfbWFudWFsX2FjdGl2aXR5X3VuYXZhaWxhYmxlLCBUb2FzdC5MRU5HVEhfTE9ORykKICAgICAgICAgICAgICAgIC5zaG93KCk7CiAgICAgICAgZmluaXNoKCk7CiAgICB9Cn1wYWNrYWdlIGNvbS5leGFtcGxlLmppdHRlcmZpeDsKCmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuQ29udGV4dDsKaW1wb3J0IGFuZHJvaWQuZ3JhcGhpY3MuQ2FudmFzOwppbXBvcnQgYW5kcm9pZC5ncmFwaGljcy5Db2xvcjsKaW1wb3J0IGFuZHJvaWQuZ3JhcGhpY3MuUGFpbnQ7CmltcG9ydCBhbmRyb2lkLm9zLkJ1bmRsZTsKaW1wb3J0IGFuZHJvaWQub3MuSGFuZGxlcjsKaW1wb3J0IGFuZHJvaWQudmlldy5WaWV3OwppbXBvcnQgYW5kcm9pZC52aWV3LldpbmRvd01hbmFnZXI7CmltcG9ydCBhbmRyb2lkeC5hbm5vdGF0aW9uLk51bGxhYmxlOwppbXBvcnQgYW5kcm9pZHguYXBwY29tcGF0LmFwcC5BcHBDb21wYXRBY3Rpdml0eTsKCnB1YmxpYyBjbGFzcyBNYWluQWN0aXZpdHkgZXh0ZW5kcyBBcHBDb21wYXRBY3Rpdml0eSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZSQU1FX1JBVEUgPSA2MDsgLy8gVOG7kWMgxJHhu5kga2h1bmcgaMOsbmggdOG7kWkgxrB1CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRlJBTUVfVElNRV9NUyA9IDEwMDAgLyBGUkFNRV9SQVRFOwogICAgcHJpdmF0ZSBDdXN0b21WaWV3IGN1c3RvbVZpZXc7CgogICAgcHJpdmF0ZSBmbG9hdCBsYXN0WCA9IDA7IC8vIEzGsHUgdHLhu68gdOG7jWEgxJHhu5kgWCB0csaw4bubYyDEkcOzCiAgICBwcml2YXRlIGZsb2F0IGxhc3RZID0gMDsgLy8gTMawdSB0cuG7ryB04buNYSDEkeG7mSBZIHRyxrDhu5tjIMSRw7MKICAgIHByaXZhdGUgZmxvYXQgc21vb3RoaW5nRmFjdG9yID0gMC4xZjsgLy8gSOG7hyBz4buRIGzDoG0gbeG7i24KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG9uQ3JlYXRlKEBOdWxsYWJsZSBCdW5kbGUgc2F2ZWRJbnN0YW5jZVN0YXRlKSB7CiAgICAgICAgc3VwZXIub25DcmVhdGUoc2F2ZWRJbnN0YW5jZVN0YXRlKTsKICAgICAgICBzZXRDb250ZW50VmlldyhSLmxheW91dC5hY3Rpdml0eV9tYWluKTsKCiAgICAgICAgY3VzdG9tVmlldyA9IG5ldyBDdXN0b21WaWV3KHRoaXMpOwogICAgICAgIHNldENvbnRlbnRWaWV3KGN1c3RvbVZpZXcpOwogICAgICAgIHN0YXJ0UmVuZGVyaW5nKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHN0YXJ0UmVuZGVyaW5nKCkgewogICAgICAgIGZpbmFsIEhhbmRsZXIgaGFuZGxlciA9IG5ldyBIYW5kbGVyKCk7CiAgICAgICAgZmluYWwgUnVubmFibGUgcnVubmFibGUgPSBuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBjdXN0b21WaWV3LmludmFsaWRhdGUoKTsgLy8gWcOqdSBj4bqndSB24bq9IGzhuqFpIEN1c3RvbVZpZXcKICAgICAgICAgICAgICAgIGhhbmRsZXIucG9zdERlbGF5ZWQodGhpcywgRlJBTUVfVElNRV9NUyk7IC8vIMSQ4bq3dCB0aOG7nWkgZ2lhbiDEkeG7gyDEkeG6oXQgxJHGsOG7o2MgRlBTCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGhhbmRsZXIucG9zdChydW5uYWJsZSk7CiAgICB9CgogICAgcHJpdmF0ZSBjbGFzcyBDdXN0b21WaWV3IGV4dGVuZHMgVmlldyB7CgogICAgICAgIHByaXZhdGUgUGFpbnQgcGFpbnQ7CiAgICAgICAgcHJpdmF0ZSBmbG9hdCBjaXJjbGVYOwogICAgICAgIHByaXZhdGUgZmxvYXQgY2lyY2xlWTsKICAgICAgICBwcml2YXRlIGZsb2F0IGNpcmNsZVJhZGl1czsKCiAgICAgICAgcHVibGljIEN1c3RvbVZpZXcoQ29udGV4dCBjb250ZXh0KSB7CiAgICAgICAgICAgIHN1cGVyKGNvbnRleHQpOwogICAgICAgICAgICBwYWludCA9IG5ldyBQYWludCgpOwogICAgICAgICAgICBwYWludC5zZXRDb2xvcihDb2xvci5CTFVFKTsgLy8gTcOgdSB4YW5oIGTGsMahbmcKICAgICAgICAgICAgY2lyY2xlUmFkaXVzID0gNTBmOwogICAgICAgICAgICByZXNldENpcmNsZVBvc2l0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBvbkRyYXcoQ2FudmFzIGNhbnZhcykgewogICAgICAgICAgICBzdXBlci5vbkRyYXcoY2FudmFzKTsKICAgICAgICAgICAgLy8gVuG6vSBu4buBbgogICAgICAgICAgICBjYW52YXMuZHJhd0NvbG9yKENvbG9yLldISVRFKTsgLy8gTcOgdSB0cuG6r25nCgogICAgICAgICAgICAvLyBW4bq9IGjDrG5oIHRyw7JuCiAgICAgICAgICAgIGNhbnZhcy5kcmF3Q2lyY2xlKGNpcmNsZVgsIGNpcmNsZVksIGNpcmNsZVJhZGl1cywgcGFpbnQpOwoKICAgICAgICAgICAgLy8gQ-G6rXAgbmjhuq10IHbhu4sgdHLDrSBow6xuaCB0csOybgogICAgICAgICAgICB1cGRhdGVDaXJjbGVQb3NpdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHJlc2V0Q2lyY2xlUG9zaXRpb24oKSB7CiAgICAgICAgICAgIC8vIMSQ4bq3dCB24buLIHRyw60gaMOsbmggdHLDsm4gbmfhuqt1IG5oacOqbiB0cm9uZyBwaOG6oW0gdmkgbcOgbiBow6xuaAogICAgICAgICAgICBjaXJjbGVYID0gKGZsb2F0KSBNYXRoLnJhbmRvbSgpICogZ2V0V2lkdGgoKTsKICAgICAgICAgICAgY2lyY2xlWSA9IChmbG9hdCkgTWF0aC5yYW5kb20oKSAqIGdldEhlaWdodCgpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUNpcmNsZVBvc2l0aW9uKCkgewogICAgICAgICAgICAvLyBEaSBjaHV54buDbiBuZ-G6q3Ugbmhpw6puCiAgICAgICAgICAgIGZsb2F0IHJhbmRvbVggPSAoZmxvYXQpIChNYXRoLnJhbmRvbSgpICogMTAgLSA1KTsKICAgICAgICAgICAgZmxvYXQgcmFuZG9tWSA9IChmbG9hdCkgKE1hdGgucmFuZG9tKCkgKiAxMCAtIDUpOwoKICAgICAgICAgICAgLy8gw4FwIGThu6VuZyBs4buNYyDEkeG7gyBnaeG6o20gcnVuZwogICAgICAgICAgICBjaXJjbGVYICs9IChyYW5kb21YICogc21vb3RoaW5nRmFjdG9yKSArIChsYXN0WCAqICgxIC0gc21vb3RoaW5nRmFjdG9yKSk7CiAgICAgICAgICAgIGNpcmNsZVkgKz0gKHJhbmRvbVkgKiBzbW9vdGhpbmdGYWN0b3IpICsgKGxhc3RZICogKDEgLSBzbW9vdGhpbmdGYWN0b3IpKTsKCiAgICAgICAgICAgIC8vIEPhuq1wIG5o4bqtdCB04buNYSDEkeG7mSBjdeG7kWkKICAgICAgICAgICAgbGFzdFggPSBjaXJjbGVYOwogICAgICAgICAgICBsYXN0WSA9IGNpcmNsZVk7CgogICAgICAgICAgICAvLyDEkOG6o20gYuG6o28gaMOsbmggdHLDsm4ga2jDtG5nIHJhIG5nb8OgaSBtw6BuIGjDrG5oCiAgICAgICAgICAgIGlmIChjaXJjbGVYIDwgY2lyY2xlUmFkaXVzKSBjaXJjbGVYID0gY2lyY2xlUmFkaXVzOwogICAgICAgICAgICBpZiAoY2lyY2xlWCA-IGdldFdpZHRoKCkgLSBjaXJjbGVSYWRpdXMpIGNpcmNsZVggPSBnZXRXaWR0aCgpIC0gY2lyY2xlUmFkaXVzOwogICAgICAgICAgICBpZiAoY2lyY2xlWSA8IGNpcmNsZVJhZGl1cykgY2lyY2xlWSA9IGNpcmNsZVJhZGl1czsKICAgICAgICAgICAgaWYgKGNpcmNsZVkgPiBnZXRIZWlnaHQoKSAtIGNpcmNsZVJhZGl1cykgY2lyY2xlWSA9IGdldEhlaWdodCgpIC0gY2lyY2xlUmFkaXVzOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIG9uUmVzdW1lKCkgewogICAgICAgIHN1cGVyLm9uUmVzdW1lKCk7CiAgICAgICAgV2luZG93TWFuYWdlci5MYXlvdXRQYXJhbXMgcGFyYW1zID0gZ2V0V2luZG93KCkuZ2V0QXR0cmlidXRlcygpOwogICAgICAgIHBhcmFtcy5mbGFncyB8PSBXaW5kb3dNYW5hZ2VyLkxheW91dFBhcmFtcy5GTEFHX0tFRVBfU0NSRUVOX09OOyAvLyBHaeG7ryBtw6BuIGjDrG5oIHPDoW5nCiAgICAgICAgZ2V0V2luZG93KCkuc2V0QXR0cmlidXRlcyhwYXJhbXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQgb25QYXVzZSgpIHsKICAgICAgICBzdXBlci5vblBhdXNlKCk7CiAgICAgICAgLy8gQ8OzIHRo4buDIGThu6tuZyBj4bqtcCBuaOG6rXQg4bufIMSRw6J5IG7hur91IGPhuqduCiAgICB9Cn0KCi8vIERlZmluZSBhIGNsYXNzIGZvciBtYW5hZ2luZyBhaW0gY29udHJvbApjbGFzcyBBaW1NYW5hZ2VyCnsKICAgIC8vIE1lbWJlciB2YXJpYWJsZXMKICAgIHByaXZhdGUgZG91YmxlIGFpbVN0YWJpbGl0eSA9IDEwMC45MDA7CiAgICBwcml2YXRlIGJvb2wgYWltQXNzaXN0RW5hYmxlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sIG5vcmVjb2lsRW5hYmxlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sIGFpbWxvY2tFbmFibGVkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2wgaGVhZHNob3RBc3Npc3RFbmFibGVkID0gZmFsc2U7CiAgICBwcml2YXRlIGRvdWJsZSBhaW1TZW5zaXRpdml0eSA9IDkxLjA7CiAgICBwcml2YXRlIGRvdWJsZSBkZXZpY2VQZXJmb3JtYW5jZSA9IDk5MS4wOwoKICAgIC8vIENvbnN0cnVjdG9yCiAgICBwdWJsaWMgQWltTWFuYWdlcigpIHsgfQoKICAgIC8vIE1ldGhvZCB0byBjb21wbGV0ZWx5IHJlbW92ZSBhaW0gaGVhdmluZXNzCiAgICBwdWJsaWMgdm9pZCBSZW1vdmVBaW1IZWF2aW5lc3MoKQogICAgewogICAgICAgIGFpbVN0YWJpbGl0eSA9IDAuMDsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQWltIGhlYXZpbmVzcyBjb21wbGV0ZWx5IHJlbW92ZWQgaW4gR2FyZW5hIEZyZWUgRmlyZS4iKTsKICAgIH0KCiAgICAvLyBNZXRob2QgdG8gZW5hYmxlIGFpbSBhc3Npc3QKICAgIHB1YmxpYyB2b2lkIEVuYWJsZUFpbUFzc2lzdCgpCiAgICB7CiAgICAgICAgYWltQXNzaXN0RW5hYmxlZCA9IHRydWU7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkFpbSBhc3Npc3QgZW5hYmxlZCBmb3IgcHJlY2lzZSBhaW1pbmcuIik7CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGVuYWJsZSBub3JlY29pbCBmZWF0dXJlCiAgICBwdWJsaWMgdm9pZCBFbmFibGVOb3JlY29pbCgpCiAgICB7CiAgICAgICAgbm9yZWNvaWxFbmFibGVkID0gdHJ1ZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiTm9yZWNvaWwgZmVhdHVyZSBlbmFibGVkIGZvciBzdGFibGUgc2hvb3RpbmcuIik7CiAgICB9CgogICAgLy8gTWV0aG9kIHRvIGVuYWJsZSBhaW1sb2NrIGZlYXR1cmUKICAgIHB1YmxpYyB2b2lkIEVuYWJsZUFpbWxvY2soKQogICAgewogICAgICAgIGFpbWxvY2tFbmFibGVkID0gdHJ1ZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQWltbG9jayBmZWF0dXJlIGVuYWJsZWQgZm9yIGxvY2tpbmcgb250byB0YXJnZXRzLiIpOwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBlbmFibGUgaGVhZHNob3QgYXNzaXN0CiAgICBwdWJsaWMgdm9pZCBFbmFibGVIZWFkc2hvdEFzc2lzdCgpCiAgICB7CiAgICAgICAgaGVhZHNob3RBc3Npc3RFbmFibGVkID0gdHJ1ZTsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSGVhZHNob3QgYXNzaXN0IGVuYWJsZWQgZm9yIHByZWNpc2UgaGVhZHNob3RzLiIpOwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBvcHRpbWl6ZSBhaW0gc2Vuc2l0aXZpdHkKICAgIHB1YmxpYyB2b2lkIE9wdGltaXplQWltU2Vuc2l0aXZpdHkoZG91YmxlIHNlbnNpdGl2aXR5RmFjdG9yKQogICAgewogICAgICAgIGFpbVNlbnNpdGl2aXR5ICo9IHNlbnNpdGl2aXR5RmFjdG9yOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJBaW0gc2Vuc2l0aXZpdHkgb3B0aW1pemVkLiIpOwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBib29zdCBkZXZpY2UgcGVyZm9ybWFuY2UKICAgIHB1YmxpYyB2b2lkIEJvb3N0RGV2aWNlUGVyZm9ybWFuY2UoZG91YmxlIGJvb3N0RmFjdG9yKQogICAgewogICAgICAgIGRldmljZVBlcmZvcm1hbmNlICo9IGJvb3N0RmFjdG9yOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJEZXZpY2UgcGVyZm9ybWFuY2UgYm9vc3RlZC4iKTsKICAgIH0KfQoKLy8gRGVmaW5lIGEgY2xhc3MgZm9yIG1hbmFnaW5nIGdhbWUgc2V0dGluZ3MKY2xhc3MgR2FtZVNldHRpbmdzCnsKICAgIC8vIE1lbWJlciB2YXJpYWJsZXMKICAgIHByaXZhdGUgc3RyaW5nIG1lc3NhZ2VEdXJhdGlvbiA9ICJW4burYSI7CiAgICBwcml2YXRlIHN0cmluZyBtZXNzYWdlRm9udFNpemUgPSAiVHJ1bmcgYsOsbmgiOwoKICAgIC8vIENvbnN0cnVjdG9yCiAgICBwdWJsaWMgR2FtZVNldHRpbmdzKCkgeyB9CgogICAgLy8gTWV0aG9kIHRvIHNldCBtZXNzYWdlIGR1cmF0aW9uCiAgICBwdWJsaWMgdm9pZCBTZXRNZXNzYWdlRHVyYXRpb24oc3RyaW5nIGR1cmF0aW9uKQogICAgewogICAgICAgIG1lc3NhZ2VEdXJhdGlvbiA9IGR1cmF0aW9uOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJNZXNzYWdlIGR1cmF0aW9uIHNldCB0bzogIiArIGR1cmF0aW9uKTsKICAgIH0KCiAgICAvLyBNZXRob2QgdG8gc2V0IG1lc3NhZ2UgZm9udCBzaXplCiAgICBwdWJsaWMgdm9pZCBTZXRNZXNzYWdlRm9udFNpemUoc3RyaW5nIGZvbnRTaXplKQogICAgewogICAgICAgIG1lc3NhZ2VGb250U2l6ZSA9IGZvbnRTaXplOwogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJNZXNzYWdlIGZvbnQgc2l6ZSBzZXQgdG86ICIgKyBmb250U2l6ZSk7CiAgICB9Cn0KCmNsYXNzIFByb2dyYW0KewogICAgc3RhdGljIHZvaWQgTWFpbihzdHJpbmdbXSBhcmdzKQogICAgewogICAgICAgIC8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBBaW1NYW5hZ2VyCiAgICAgICAgQWltTWFuYWdlciBhaW1NYW5hZ2VyID0gbmV3IEFpbU1hbmFnZXIoKTsKCiAgICAgICAgLy8gRW5hYmxlIGFpbSBhc3Npc3QKICAgICAgICBhaW1NYW5hZ2VyLkVuYWJsZUFpbUFzc2lzdCgpOwoKICAgICAgICAvLyBFbmFibGUgbm9yZWNvaWwKICAgICAgICBhaW1NYW5hZ2VyLkVuYWJsZU5vcmVjb2lsKCk7CgogICAgICAgIC8vIEVuYWJsZSBhaW1sb2NrCiAgICAgICAgYWltTWFuYWdlci5FbmFibGVBaW1sb2NrKCk7CgogICAgICAgIC8vIEVuYWJsZSBoZWFkc2hvdCBhc3Npc3QKICAgICAgICBhaW1NYW5hZ2VyLkVuYWJsZUhlYWRzaG90QXNzaXN0KCk7CgogICAgICAgIC8vIE9wdGltaXplIGFpbSBzZW5zaXRpdml0eQogICAgICAgIGFpbU1hbmFnZXIuT3B0aW1pemVBaW1TZW5zaXRpdml0eSgyLjApOwoKICAgICAgICAvLyBCb29zdCBkZXZpY2UgcGVyZm9ybWFuY2UKICAgICAgICBhaW1NYW5hZ2VyLkJvb3N0RGV2aWNlUGVyZm9ybWFuY2UoMS41KTsKCiAgICAgICAgLy8gUmVtb3ZlIGFpbSBoZWF2aW5lc3MKICAgICAgICBhaW1NYW5hZ2VyLlJlbW92ZUFpbUhlYXZpbmVzcygpOwoKICAgICAgICAvLyBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgR2FtZVNldHRpbmdzCiAgICAgICAgR2FtZVNldHRpbmdzIGdhbWVTZXR0aW5ncyA9IG5ldyBHYW1lU2V0dGluZ3MoKTsKCiAgICAgICAgLy8gU2V0IG1lc3NhZ2UgZHVyYXRpb24gdG8gIkTDoGkiCiAgICAgICAgZ2FtZVNldHRpbmdzLlNldE1lc3NhZ2VEdXJhdGlvbigiRMOgaSIpOwoKICAgICAgICAvLyBTZXQgbWVzc2FnZSBmb250IHNpemUgdG8gIkzhu5tuIgogICAgICAgIGdhbWVTZXR0aW5ncy5TZXRNZXNzYWdlRm9udFNpemUoIkzhu5tuIik7CiAgICB9Cn0KCnB1YmxpYyBjbGFzcyBQZXJmb3JtYW5jZUJvb3N0ZXIKewogICAgLy8gTWV0aG9kIHRvIGJvb3N0IGRldmljZSBwZXJmb3JtYW5jZS4KICAgIHB1YmxpYyB2b2lkIEJvb3N0RGV2aWNlUGVyZm9ybWFuY2UoKQogICAgewogICAgICAgIC8vIEluY3JlYXNlIENQVSBwZXJmb3JtYW5jZQogICAgICAgIEluY3JlYXNlQ1BVUGVyZm9ybWFuY2UoKTsKCiAgICAgICAgLy8gT3B0aW1pemUgUkFNIHVzYWdlCiAgICAgICAgT3B0aW1pemVSQU1Vc2FnZSgpOwoKICAgICAgICAvLyBEZWZyYWdtZW50IGRpc2sgZm9yIGZhc3RlciBhY2Nlc3MKICAgICAgICBEZWZyYWdtZW50RGlzaygpOwoKICAgICAgICAvLyBDbG9zZSB1bm5lY2Vzc2FyeSBiYWNrZ3JvdW5kIHByb2Nlc3NlcwogICAgICAgIENsb3NlQmFja2dyb3VuZFByb2Nlc3NlcygpOwoKICAgICAgICAvLyBDbGVhbiB1cCB0ZW1wb3JhcnkgZmlsZXMKICAgICAgICBDbGVhbnVwVGVtcG9yYXJ5RmlsZXMoKTsKICAgIH0KCiAgICAvLyBNZXRob2QgdG8gaW5jcmVhc2UgQ1BVIHBlcmZvcm1hbmNlLgogICAgcHJpdmF0ZSB2b2lkIEluY3JlYXNlQ1BVUGVyZm9ybWFuY2UoKQogICAgewogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJJbmNyZWFzaW5nIENQVSBwZXJmb3JtYW5jZS4uLiIpOwogICAgICAgIC8vIEFkZCBjb2RlIGhlcmUgdG8gaW5jcmVhc2UgQ1BVIHBlcmZvcm1hbmNlCiAgICB9CgogICAgLy8gTWV0aG9kIHRvIG9wdGltaXplIFJBTSB1c2FnZS4KICAgIHByaXZhdGUgdm9pZCBPcHRpbWl6ZVJBTVVzYWdlKCkKICAgIHsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiT3B0aW1pemluZyBSQU0gdXNhZ2UuLi4iKTsKICAgICAgICAvLyBBZGQgY29kZSBoZXJlIHRvIG9wdGltaXplIFJBTSB1c2FnZQogICAgfQoKICAgIC8vIE1ldGhvZCB0byBkZWZyYWdtZW50IGRpc2sgZm9yIGZhc3RlciBhY2Nlc3MuCiAgICBwcml2YXRlIHZvaWQgRGVmcmFnbWVudERpc2soKQogICAgewogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJEZWZyYWdtZW50aW5nIGRpc2sgZm9yIGZhc3RlciBhY2Nlc3MuLi4iKTsKICAgICAgICAvLyBBZGQgY29kZSBoZXJlIHRvIGRlZnJhZ21lbnQgZGlzawogICAgfQoKICAgIC8vIE1ldGhvZCB0byBjbG9zZSB1bm5lY2Vzc2FyeSBiYWNrZ3JvdW5kIHByb2Nlc3Nlcy4KICAgIHByaXZhdGUgdm9pZCBDbG9zZUJhY2tncm91bmRQcm9jZXNzZXMoKQogICAgewogICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJDbG9zaW5nIHVubmVjZXNzYXJ5IGJhY2tncm91bmQgcHJvY2Vzc2VzLi4uIik7CiAgICAgICAgLy8gQWRkIGNvZGUgaGVyZSB0byBjbG9zZSB1bm5lY2Vzc2FyeSBiYWNrZ3JvdW5kIHByb2Nlc3NlcwogICAgfQoKICAgIC8vIE1ldGhvZCB0byBjbGVhbiB1cCB0ZW1wb3JhcnkgZmlsZXMuCiAgICBwcml2YXRlIHZvaWQgQ2xlYW51cFRlbXBvcmFyeUZpbGVzKCkKICAgIHsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQ2xlYW5pbmcgdXAgdGVtcG9yYXJ5IGZpbGVzLi4uIik7CiAgICAgICAgLy8gQWRkIGNvZGUgaGVyZSB0byBjbGVhbiB1cCB0ZW1wb3JhcnkgZmlsZXMKICAgIH0KfQoKY2xhc3MgUHJvZ3JhbQp7CiAgICBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpCiAgICB7CiAgICAgICAgLy8gQ3JlYXRlIGFuIGluc3RhbmNlIG9mIFBlcmZvcm1hbmNlQm9vc3RlcgogICAgICAgIFBlcmZvcm1hbmNlQm9vc3RlciBib29zdGVyID0gbmV3IFBlcmZvcm1hbmNlQm9vc3RlcigpOwoKICAgICAgICAvLyBCb29zdCBkZXZpY2UgcGVyZm9ybWFuY2UKICAgICAgICBib29zdGVyLkJvb3N0RGV2aWNlUGVyZm9ybWFuY2UoKTsKICAgIH0KfQ